<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>The Boo-riculum – January Week 1</title>
<meta name="theme-color" content="#7c3aed">
<link rel="icon" type="image/png" href="booha-ghost.png">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700;800;900&display=swap" rel="stylesheet" />
<style>
:root{
  --radius:28px;
  --bg:url('https://static.wixstatic.com/media/fa59b9_f8915cfdff974d7883c730f51f577d31~mv2.jpg');
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{
  height:100%;
  font-family:system-ui,Segoe UI,Roboto,Inter,sans-serif;
  background:linear-gradient(160deg,rgba(124,58,237,.1),rgba(34,211,238,.1)),#0f172a;
  overflow:hidden;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  color:#111; position:relative;
}
body::before{
  content:""; position:fixed; inset:0; z-index:-1;
  background-image:var(--bg); background-size:cover; background-position:center; opacity:.25;
}
.back-btn{
  position:fixed; top:14px; left:14px; z-index:1000;
  display:inline-flex; align-items:center; gap:.5rem;
  padding:.55rem .9rem; border-radius:999px; background:#0b1020; color:#fff;
  border:1px solid rgba(255,255,255,.25); box-shadow:0 10px 25px rgba(0,0,0,.35);
  font-weight:800; font-size:.95rem; text-decoration:none; -webkit-tap-highlight-color:transparent;
}
header{text-align:center;color:#fff;margin-bottom:20px;}
header h1{font-family:'Cinzel',serif;font-size:clamp(26px,4.5vw,50px);letter-spacing:1px;margin-bottom:10px;font-weight:900;}
header h2{font-size:clamp(22px,3.5vw,36px);margin-bottom:6px;font-weight:800;}
header h3{font-size:clamp(18px,3vw,30px);font-weight:600;color:#dbeafe;}

.card-outer{width:min(92vw,900px);aspect-ratio:3/2;perspective:1500px;display:flex;align-items:center;justify-content:center;}
.card{
  position:relative; width:100%; height:100%;
  border-radius:var(--radius); transform-style:preserve-3d;
  transition:transform .7s cubic-bezier(.2,.8,.2,1);
  box-shadow:0 30px 80px rgba(0,0,0,.3);
  border:3px solid rgba(255,255,255,.25);
  background-size:100% 240px;               /* stripe thickness */
  animation:stripeDown 6s linear infinite;  /* move downward */
}
@keyframes stripeDown{
  0%{background-position:0 0;}
  100%{background-position:0 240px;}
}
.card.is-back{transform:rotateY(180deg)}
.face{
  position:absolute; inset:0; border-radius:var(--radius); backface-visibility:hidden;
  display:flex; align-items:center; justify-content:center; flex-direction:column; text-align:center;
  padding:1rem;
  background:rgba(255,255,255,1); /* full vivid color, no fade */
}
.face.back{transform:rotateY(180deg)}
.term h2{margin:0; font-size:clamp(40px,8vw,90px); font-weight:900; line-height:1.1; color:#111; text-shadow:0 2px 6px rgba(255,255,255,.6);}
.term p{margin-top:.5rem; font-size:clamp(20px,3vw,30px); color:#333;}

.actions{display:flex; gap:20px; justify-content:center; margin-top:30px; flex-wrap:wrap;}
button.btn{
  padding:1rem 1.3rem; border-radius:16px; border:none;
  background:linear-gradient(180deg,#fff,#e0e0e0);
  box-shadow:0 10px 25px rgba(0,0,0,.15);
  font-weight:800; cursor:pointer; font-size:1.1rem;
}
#speakBtn{
  background:linear-gradient(180deg,#ff4444,#cc0000); color:#fff; font-size:1.3rem; line-height:1;
  padding:1rem 1.5rem; border:none; border-radius:16px; box-shadow:0 0 20px rgba(255,0,0,.4);
  transition:transform .15s;
}
#speakBtn:hover{transform:scale(1.1)}

footer{
  position:fixed; bottom:18px; left:0; width:100%;
  text-align:center; color:#d1d5db; font-family:'Cinzel',serif;
  font-size:clamp(14px,2vw,18px); letter-spacing:1px; opacity:.9;
}
</style>
</head>
<body>
  <a href="#" class="back-btn" id="backMenu"><span class="arrow">❮</span> Back to Menu</a>

  <header>
    <h1>The Boo-riculum</h1>
    <h2>January Week 1</h2>
    <h3>１月第１週</h3>
  </header>

  <div class="card-outer">
    <article class="card" id="card">
      <div class="face front"><div class="term"><h2 id="frontTitle"></h2><p id="frontSub"></p></div></div>
      <div class="face back"><div class="term"><h2 id="backTitle"></h2><p id="backSub"></p></div></div>
    </article>
  </div>

  <div class="actions">
    <button class="btn" id="prevBtn">❮ Prev</button>
    <button class="btn" id="flipBtn">Flip ⤾</button>
    <button class="btn" id="nextBtn">Next ❯</button>
    <button id="speakBtn">▶</button>
  </div>

  <footer>Bryan's English School</footer>

<script>
/* Vivid palettes for downward stripes (each card = different set) */
const PALETTES = [
  ["#ff7eb9","#5ee6ff","#fff680","#8aff80","#c77dff","#7dd3fc"],
  ["#ffd166","#7afcff","#ff9f9f","#baffc9","#e7baff","#bae1ff"],
  ["#ffb3ba","#8aff80","#ffd6a5","#7dd3fc","#ff7eb9","#fdffb6"],
  ["#5ee6ff","#ffd166","#c77dff","#8aff80","#ff7eb9","#fff680"],
  ["#7dd3fc","#ffd6a5","#e7baff","#ff9f9f","#baffc9","#ff7eb9"]
];

const CARDS=[
  {en:"goal",jp:"目標",hira:"もくひょう"},
  {en:"plan",jp:"計画",hira:"けいかく"},
  {en:"future",jp:"未来",hira:"みらい"},
  {en:"dream",jp:"夢",hira:"ゆめ"},
  {en:"challenge",jp:"挑戦",hira:"ちょうせん"},
  {en:"try",jp:"挑戦する",hira:"ちょうせん する"},
  {en:"change",jp:"変える",hira:"かえる"},
  {en:"habit",jp:"習慣",hira:"しゅうかん"},
  {en:"exercise",jp:"運動",hira:"うんどう"},
  {en:"study",jp:"勉強",hira:"べんきょう"},
  {en:"learn",jp:"学ぶ",hira:"まなぶ"},
  {en:"practice",jp:"練習",hira:"れんしゅう"},
  {en:"success",jp:"成功",hira:"せいこう"},
  {en:"focus",jp:"集中",hira:"しゅうちゅう"},
  {en:"motivation",jp:"やる気",hira:"やるき"}
];

/* shuffle cards */
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}
shuffle(CARDS);

let i=0, back=false;
const card=document.getElementById('card');
const frontTitle=document.getElementById('frontTitle');
const backTitle=document.getElementById('backTitle');
const backSub=document.getElementById('backSub');

/* Build a vivid downward stripe background from a palette */
function buildStripeBackground(colors){
  // each color band = 40px tall; repeat through the list
  let stops = [];
  let y = 0;
  const band = 40; // thickness of each stripe
  colors.forEach((c,idx)=>{
    const start = y + idx*band;
    stops.push(`${c} ${start}px ${start+band}px`);
  });
  // repeat the sequence twice for density
  const all = stops.concat(stops.map(s=>s.replace(/(\d+)px/g,(m,n)=> (parseInt(n)+band*colors.length)+"px")));
  return `repeating-linear-gradient(180deg, ${all.join(",")})`;
}

/* --- TTS: Sage voice with robust Safari playback + caching --- */
let speaking = false;
async function speak(text){
  try{
    if(speaking) return; speaking = true; setTimeout(()=>speaking=false,300); // small debounce
    const key = 'sage_' + encodeURIComponent(text);
    let url = localStorage.getItem(key);

    if(!url){
      const res = await fetch(`https://bryanharper.tokyo/_functions/tts?text=${encodeURIComponent(text)}&voice=sage`, { mode:'cors' });
      const data = await res.json();
      url = data.url;                     // data:audio/mpeg;base64,...
      if (url) localStorage.setItem(key, url);
    }

    // Safari-friendly: convert data URL -> Blob URL
    if(url && url.startsWith('data:audio')){
      const base64 = url.split(',')[1];
      const raw = atob(base64);
      const bytes = new Uint8Array(raw.length);
      for (let n=0;n<raw.length;n++) bytes[n] = raw.charCodeAt(n);
      const blob = new Blob([bytes], {type:'audio/mpeg'});
      const objectUrl = URL.createObjectURL(blob);
      const audio = new Audio(objectUrl);
      audio.play().catch(console.warn);
      // revoke later
      audio.onended = ()=> URL.revokeObjectURL(objectUrl);
    } else if (url){
      // if backend ever returns a normal URL
      new Audio(url).play().catch(console.warn);
    }
  }catch(err){
    console.error('TTS error:', err);
  }
}

/* render the current card */
function show(){
  const c = CARDS[i];
  const palette = PALETTES[i % PALETTES.length];
  card.style.backgroundImage = buildStripeBackground(palette);
  card.style.animationDuration = '6s'; // steady downward flow

  frontTitle.textContent = c.en;
  backTitle.textContent  = c.jp;
  backSub.textContent    = c.hira;
  card.classList.toggle('is-back', back);
}

/* controls */
document.getElementById('flipBtn').onclick = ()=>{ back=!back; show(); };
document.getElementById('nextBtn').onclick = ()=>{ i=(i+1)%CARDS.length; back=false; show(); };
document.getElementById('prevBtn').onclick = ()=>{ i=(i-1+CARDS.length)%CARDS.length; back=false; show(); };
document.getElementById('speakBtn').onclick = ()=>{ if(!back) speak(CARDS[i].en); };
document.getElementById('backMenu').onclick = (e)=>{ e.preventDefault(); if(document.referrer) history.back(); else location.href='index.html'; };

show();
</script>
</body>
</html>
