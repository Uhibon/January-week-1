<script>
/* vivid palettes */
const PALETTES=[
  ["#ff007f","#00c3ff","#ffe600","#39ff14","#8b00ff","#ff4d4d"],
  ["#ff4b1f","#1fddff","#f9ed69","#00ff9c","#d16ba5","#8ef6e4"],
  ["#ff6ec7","#5ee6ff","#fff680","#a6f7b2","#c77dff","#7dd3fc"],
  ["#ff9f00","#ff00a6","#00ffe1","#ffee00","#00d9ff","#ff6b6b"],
  ["#ff5f6d","#ffc371","#00c9ff","#92fe9d","#a890fe","#fbc8d4"]
];

const CARDS=[
  {en:"goal",jp:"目標",hira:"もくひょう"},
  {en:"plan",jp:"計画",hira:"けいかく"},
  {en:"future",jp:"未来",hira:"みらい"},
  {en:"dream",jp:"夢",hira:"ゆめ"},
  {en:"challenge",jp:"挑戦",hira:"ちょうせん"},
  {en:"try",jp:"挑戦する",hira:"ちょうせん する"},
  {en:"change",jp:"変える",hira:"かえる"},
  {en:"habit",jp:"習慣",hira:"しゅうかん"},
  {en:"exercise",jp:"運動",hira:"うんどう"},
  {en:"study",jp:"勉強",hira:"べんきょう"},
  {en:"learn",jp:"学ぶ",hira:"まなぶ"},
  {en:"practice",jp:"練習",hira:"れんしゅう"},
  {en:"success",jp:"成功",hira:"せいこう"},
  {en:"focus",jp:"集中",hira:"しゅうちゅう"},
  {en:"motivation",jp:"やる気",hira:"やるき"}
];

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}
shuffle(CARDS);

let i=0, back=false;
const card=document.getElementById('card');
const frontTitle=document.getElementById('frontTitle');
const frontSub=document.getElementById('frontSub');
const backTitle=document.getElementById('backTitle');
const backSub=document.getElementById('backSub');

/* Stripe builder */
function buildStripeBackground(colors){
  const band=40; let stops=[];
  colors.forEach((c,idx)=>{
    const start=idx*band;
    stops.push(`${c} ${start}px ${start+band}px`);
  });
  const all=stops.concat(stops.map(s=>s.replace(/(\d+)px/g,(m,n)=>(parseInt(n)+band*colors.length)+'px')));
  return `repeating-linear-gradient(180deg,${all.join(',')})`;
}

/* ✅ Local Sage audio */
function speak(text){
  if(!text) return;
  const filename=text.toLowerCase().replace(/[^a-z0-9]/g,"")+".mp3";
  const audioPath=`audio/${filename}`;
  const a=new Audio(audioPath);
  a.play().catch(err=>console.log("Audio error:",err));
  triggerSparkles(); // sparkle when Sage speaks
}

/* ✨ Sparkle animation fix */
const sparkContainer=document.getElementById("sparkleContainer");
function triggerSparkles(){
  sparkContainer.innerHTML="";
  for(let i=0;i<18;i++){
    const s=document.createElement("div");
    s.className="sparkle";
    s.style.left=Math.random()*100+"%";
    s.style.bottom=Math.random()*100+"%";
    s.style.animationDelay=(Math.random()*2)+"s";
    s.style.transform=`scale(${0.7+Math.random()*1.3})`;
    sparkContainer.appendChild(s);
    setTimeout(()=>s.remove(),3000);
  }
}

/* Show card */
function show(){
  const c=CARDS[i];
  const palette=PALETTES[i%PALETTES.length];
  card.style.backgroundImage=buildStripeBackground(palette);
  frontTitle.textContent=c.en;
  frontSub.textContent=c.hira;
  backTitle.textContent=c.jp;
  backSub.textContent=c.hira;
  card.classList.toggle('is-back',back);
}

/* Controls */
document.getElementById('flipBtn').onclick=()=>{back=!back;show();};
document.getElementById('nextBtn').onclick=()=>{i=(i+1)%CARDS.length;back=false;show();};
document.getElementById('prevBtn').onclick=()=>{i=(i-1+CARDS.length)%CARDS.length;back=false;show();};
document.getElementById('speakBtn').onclick=()=>{const c=CARDS[i];speak(back?c.jp:c.en);};
document.getElementById('backMenu').onclick=(e)=>{e.preventDefault();if(document.referrer)history.back();else location.href='index.html';};

show();
</script>
